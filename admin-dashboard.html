<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Online Examination System</title>
    <link rel="stylesheet" href="style2.css">
    <style>
        /* Additional styles for admin dashboard */
        .dashboard {
            padding: 30px 0;
        }

        .dashboard-header {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .dashboard-header h2 {
            color: #1a2a6c;
            margin-bottom: 10px;
            font-size: 1.8rem;
        }

        .dashboard-header p {
            color: #666;
            margin: 0;
        }

        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .dashboard-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            text-align: center;
            transition: transform 0.3s;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .dashboard-card h3 {
            color: #555;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .dashboard-card .number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #1a2a6c;
            margin-bottom: 10px;
        }

        .dashboard-card p {
            color: #777;
            font-size: 0.9rem;
        }

        .search-filter {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            padding: 0;
        }

        .search-box {
            flex: 1;
        }

        .filter-select {
            width: 200px;
        }

        .form-control {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #1a2a6c;
        }

        .table-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
            overflow: hidden;
        }

        .table-container h3 {
            padding: 20px;
            color: #1a2a6c;
            border-bottom: 1px solid #eee;
            margin: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px 20px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .role-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .role-student {
            background: #d1ecf1;
            color: #0c5460;
        }

        .role-examiner {
            background: #e2e3e5;
            color: #383d41;
        }

        .role-admin {
            background: #d4edda;
            color: #155724;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-active {
            background: #d4edda;
            color: #155724;
        }

        .status-inactive {
            background: #f8d7da;
            color: #721c24;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-outline {
            background: transparent;
            color: #1a2a6c;
            border: 2px solid #1a2a6c;
        }

        .btn-outline:hover {
            background: #1a2a6c;
            color: white;
        }
    </style>
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">
                <div style="width: 50px; height: 50px; background: white; display: flex; align-items: center; justify-content: center; border-radius: 5px; font-weight: bold; color: #1a2a6c;">
                    LUCT
                </div>
            </div>
            <div class="title">
                <h1>Limkokwing University Of Creative Technology</h1>
                <p>Administrator Portal - Online Examination System</p>
            </div>
            <div class="nav-links">
                <a href="index1.html">Home</a>
                <a href="login.html">Login</a>
                <a href="student-dashboard.html">Student Portal</a>
                <a href="examiner-dashboard.html">Examiner Portal</a>
                <a href="admin-dashboard.html" class="active">Administrator</a>
            </div>
            <div class="mobile-menu">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Admin Dashboard -->
    <section class="dashboard">
        <div class="container">
            <div class="dashboard-header">
                <div>
                    <h2>Administrator Dashboard</h2>
                    <p id="adminWelcome">Welcome, Administrator</p>
                </div>
                <button class="btn btn-secondary" onclick="logout()">Logout</button>
            </div>

            <div class="dashboard-cards">
                <div class="dashboard-card">
                    <h3>Total Users</h3>
                    <div class="number" id="totalUsers">0</div>
                    <p>Registered in system</p>
                </div>
                <div class="dashboard-card">
                    <h3>Students</h3>
                    <div class="number" id="totalStudents">0</div>
                    <p>Active student accounts</p>
                </div>
                <div class="dashboard-card">
                    <h3>Examiners</h3>
                    <div class="number" id="totalExaminers">0</div>
                    <p>Active examiner accounts</p>
                </div>
                <div class="dashboard-card">
                    <h3>Admins</h3>
                    <div class="number" id="totalAdmins">0</div>
                    <p>System administrators</p>
                </div>
            </div>

            <div class="search-filter">
                <div class="search-box">
                    <input type="text" id="userSearch" class="form-control" placeholder="Search users by name, ID, or email...">
                </div>
                <div class="filter-select">
                    <select id="roleFilter" class="form-control">
                        <option value="all">All Roles</option>
                        <option value="student">Students</option>
                        <option value="examiner">Examiners</option>
                        <option value="admin">Administrators</option>
                    </select>
                </div>
                <div class="filter-select">
                    <select id="statusFilter" class="form-control">
                        <option value="all">All Statuses</option>
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
            </div>

            <div class="table-container">
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                    <h3>User Management</h3>
                    <button class="btn btn-primary" onclick="showRegisterModal()">Add New User</button>
                </div>
                <div id="userAlert"></div>
                <table>
                    <thead>
                        <tr>
                            <th>User ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Role</th>
                            <th>Department</th>
                            <th>Status</th>
                            <th>Registration Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <tr>
                            <td colspan="8" style="text-align: center;">No users registered yet</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-container" style="margin-top: 30px;">
                <h3 style="padding: 20px 20px 0;">System Statistics</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>Value</th>
                            <th>Change</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Total Exams Conducted</td>
                            <td>0</td>
                            <td>+0%</td>
                            <td><span style="color: #e74c3c;">No Data</span></td>
                        </tr>
                        <tr>
                            <td>System Uptime</td>
                            <td>100%</td>
                            <td>+0%</td>
                            <td><span style="color: #27ae60;">Excellent</span></td>
                        </tr>
                        <tr>
                            <td>Active Sessions</td>
                            <td id="activeSessions">1</td>
                            <td>+0%</td>
                            <td><span style="color: #27ae60;">Stable</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Add User Modal -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New User</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div id="addUserAlert"></div>
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="addUserType">Account Type</label>
                        <select id="addUserType" required>
                            <option value="">Select Account Type</option>
                            <option value="student">Student</option>
                            <option value="examiner">Examiner</option>
                            <option value="admin">Administrator</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="addFullName">Full Name</label>
                        <input type="text" id="addFullName" placeholder="Enter full name" required>
                    </div>
                    <div class="form-group">
                        <label for="addEmail">Email Address</label>
                        <input type="email" id="addEmail" placeholder="Enter email" required>
                    </div>
                    <div class="form-group">
                        <label for="addUserId">User ID</label>
                        <input type="text" id="addUserId" placeholder="Enter user ID" required>
                    </div>
                    <div class="form-group">
                        <label for="addDepartment">Department</label>
                        <select id="addDepartment" required>
                            <option value="">Select Department</option>
                            <option value="Computer Science">Computer Science</option>
                            <option value="Software Engineering">Software Engineering</option>
                            <option value="Information Technology">Information Technology</option>
                            <option value="Web Design">Web Design</option>
                            <option value="Principles of Design">Principles of Design</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Administration">Administration</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="addPassword">Password</label>
                        <input type="password" id="addPassword" placeholder="Create password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="addConfirmPassword">Confirm Password</label>
                        <input type="password" id="addConfirmPassword" placeholder="Confirm password" required>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="closeAddUserModal()">Cancel</button>
                        <button type="submit" class="btn btn-primary">Create User</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h4>Limkokwing University</h4>
                    <p>Innovating education through technology and creativity</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="index1.html">Home</a></li>
                        <li><a href="login.html">Login</a></li>
                        
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Us</h4>
                    <p>Email: support@limkokwing.edu</p>
                    <p>Phone: +266 456 7890</p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Limkokwing University. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <script>
        // Admin Dashboard JavaScript - Complete Working Version
        let currentUser = null;

        // Initialize admin dashboard
        function initAdminDashboard() {
            console.log('Initializing admin dashboard...');
            
            // Check authentication
            currentUser = checkAuth('admin');
            
            if (!currentUser) {
                console.log('User not authenticated, redirecting to login...');
                return;
            }
            
            // Update welcome message
            document.getElementById('adminWelcome').textContent = `Welcome, ${currentUser.name}`;
            
            // Set up event listeners
            setupAdminEventListeners();
            
            // Load initial data
            updateAdminDashboard();
            
            console.log('Admin dashboard initialized successfully');
        }

        // Check authentication
        function checkAuth(requiredType) {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            
            if (!currentUser) {
                alert('Please login first!');
                window.location.href = 'login.html';
                return null;
            }
            
            if (requiredType && currentUser.type !== requiredType) {
                alert('Access denied! Admin privileges required.');
                window.location.href = 'login.html';
                return null;
            }
            
            return currentUser;
        }

        // Set up admin event listeners
        function setupAdminEventListeners() {
            const addUserForm = document.getElementById('addUserForm');
            const userSearch = document.getElementById('userSearch');
            const roleFilter = document.getElementById('roleFilter');
            const statusFilter = document.getElementById('statusFilter');
            
            if (addUserForm) {
                addUserForm.addEventListener('submit', handleAddUser);
            }
            
            if (userSearch) {
                userSearch.addEventListener('input', filterUsers);
            }
            
            if (roleFilter) {
                roleFilter.addEventListener('change', filterUsers);
            }
            
            if (statusFilter) {
                statusFilter.addEventListener('change', filterUsers);
            }
            
            // Close modal events
            const closeModalBtns = document.querySelectorAll('.close-modal');
            closeModalBtns.forEach(btn => {
                btn.addEventListener('click', closeAddUserModal);
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                const addUserModal = document.getElementById('addUserModal');
                if (e.target === addUserModal) {
                    closeAddUserModal();
                }
            });
        }

        // Update admin dashboard
        function updateAdminDashboard() {
            const users = JSON.parse(localStorage.getItem('universityUsers') || '[]');
            
            // Update statistics
            updateAdminStats(users);
            
            // Update user table
            renderUsersTable(users);
        }

        // Update admin statistics
        function updateAdminStats(users) {
            const totalUsers = users.length;
            const totalStudents = users.filter(u => u.type === 'student').length;
            const totalExaminers = users.filter(u => u.type === 'examiner').length;
            const totalAdmins = users.filter(u => u.type === 'admin').length;
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalStudents').textContent = totalStudents;
            document.getElementById('totalExaminers').textContent = totalExaminers;
            document.getElementById('totalAdmins').textContent = totalAdmins;
            
            // Update active sessions
            const activeSessions = localStorage.getItem('currentUser') ? 1 : 0;
            document.getElementById('activeSessions').textContent = activeSessions;
        }

        // Render users table
        function renderUsersTable(users, filteredUsers = null) {
            const usersToRender = filteredUsers || users;
            const tableBody = document.getElementById('usersTableBody');
            
            if (!tableBody) return;
            
            tableBody.innerHTML = '';
            
            if (usersToRender.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">No users found</td></tr>';
                return;
            }
            
            usersToRender.forEach(user => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td><span class="role-badge role-${user.type}">${user.type.charAt(0).toUpperCase() + user.type.slice(1)}</span></td>
                    <td>${user.department}</td>
                    <td><span class="status-badge status-${user.status}">${user.status.charAt(0).toUpperCase() + user.status.slice(1)}</span></td>
                    <td>${user.registrationDate}</td>
                    <td>
                        <button class="btn btn-outline" onclick="editUser('${user.id}')">Edit</button>
                        <button class="btn btn-warning" onclick="resetUserPassword('${user.id}')">Reset Password</button>
                        ${user.type !== 'admin' ? `<button class="btn btn-danger" onclick="deleteUser('${user.id}')">Delete</button>` : ''}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Filter users
        function filterUsers() {
            const users = JSON.parse(localStorage.getItem('universityUsers') || '[]');
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const roleFilterValue = document.getElementById('roleFilter').value;
            const statusFilterValue = document.getElementById('statusFilter').value;
            
            let filteredUsers = users;
            
            // Apply search filter
            if (searchTerm) {
                filteredUsers = filteredUsers.filter(user => 
                    user.name.toLowerCase().includes(searchTerm) ||
                    user.email.toLowerCase().includes(searchTerm) ||
                    user.id.toLowerCase().includes(searchTerm)
                );
            }
            
            // Apply role filter
            if (roleFilterValue !== 'all') {
                filteredUsers = filteredUsers.filter(user => user.type === roleFilterValue);
            }
            
            // Apply status filter
            if (statusFilterValue !== 'all') {
                filteredUsers = filteredUsers.filter(user => user.status === statusFilterValue);
            }
            
            renderUsersTable(users, filteredUsers);
        }

        // Show add user modal
        function showRegisterModal() {
            const addUserModal = document.getElementById('addUserModal');
            const addUserAlert = document.getElementById('addUserAlert');
            
            if (addUserModal && addUserAlert) {
                addUserModal.style.display = 'flex';
                addUserAlert.innerHTML = '';
                
                const addUserForm = document.getElementById('addUserForm');
                if (addUserForm) {
                    addUserForm.reset();
                }
            }
        }

        // Close add user modal
        function closeAddUserModal() {
            const addUserModal = document.getElementById('addUserModal');
            if (addUserModal) {
                addUserModal.style.display = 'none';
            }
        }

        // Handle add user form submission
        function handleAddUser(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('addFullName').value;
            const email = document.getElementById('addEmail').value;
            const userId = document.getElementById('addUserId').value;
            const department = document.getElementById('addDepartment').value;
            const password = document.getElementById('addPassword').value;
            const confirmPassword = document.getElementById('addConfirmPassword').value;
            const userType = document.getElementById('addUserType').value;
            const addUserAlert = document.getElementById('addUserAlert');
            
            // Validate passwords match
            if (password !== confirmPassword) {
                showAlert(addUserAlert, 'Passwords do not match!', 'error');
                return;
            }
            
            // Check if user already exists
            const users = JSON.parse(localStorage.getItem('universityUsers') || '[]');
            if (users.find(u => u.id === userId || u.email === email)) {
                showAlert(addUserAlert, 'User with this ID or email already exists!', 'error');
                return;
            }
            
            // Create new user
            const newUser = {
                id: userId,
                name: fullName,
                email: email,
                password: password,
                type: userType,
                department: department,
                status: 'active',
                registrationDate: new Date().toISOString().split('T')[0]
            };
            
            // Save user
            users.push(newUser);
            localStorage.setItem('universityUsers', JSON.stringify(users));
            
            // Show success message
            showAlert(addUserAlert, 'User created successfully!', 'success');
            
            // Update dashboard and close modal after delay
            setTimeout(() => {
                closeAddUserModal();
                updateAdminDashboard();
            }, 1500);
        }

        // Edit user
        function editUser(userId) {
            alert(`Edit user functionality for ${userId} would be implemented here.`);
        }

        // Reset user password
        function resetUserPassword(userId) {
            if (confirm(`Reset password for user ${userId} to "123456"?`)) {
                const users = JSON.parse(localStorage.getItem('universityUsers') || '[]');
                const userIndex = users.findIndex(u => u.id === userId);
                
                if (userIndex !== -1) {
                    users[userIndex].password = '123456';
                    localStorage.setItem('universityUsers', JSON.stringify(users));
                    
                    const userAlert = document.getElementById('userAlert');
                    showAlert(userAlert, 'Password reset successfully to "123456"', 'success');
                    
                    // Clear alert after 3 seconds
                    setTimeout(() => {
                        userAlert.innerHTML = '';
                    }, 3000);
                }
            }
        }

        // Delete user
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                const users = JSON.parse(localStorage.getItem('universityUsers') || '[]');
                const updatedUsers = users.filter(u => u.id !== userId);
                localStorage.setItem('universityUsers', JSON.stringify(updatedUsers));
                updateAdminDashboard();
                
                const userAlert = document.getElementById('userAlert');
                showAlert(userAlert, 'User deleted successfully!', 'success');
                
                // Clear alert after 3 seconds
                setTimeout(() => {
                    userAlert.innerHTML = '';
                }, 3000);
            }
        }

        // Show alert message
        function showAlert(container, message, type) {
            if (container) {
                container.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            }
        }

        // Logout function
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                window.location.href = 'login.html';
            }
        }

        // Initialize admin dashboard when page loads
        document.addEventListener('DOMContentLoaded', initAdminDashboard);
    </script>
</body>
</html>